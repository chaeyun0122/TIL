# Database Resource Manager 사용
## Consumer Group 생성 및 유저 추가
```SQL
BEGIN
    DBMS_RESOURCE_MANAGER.CLEAR_PENDING_AREA();
    DBMS_RESOURCE_MANAGER.CREATE_PENDING_AREA(); --보류영역을 생성
    DBMS_RESOURCE_MANAGER.CREATE_CONSUMER_GROUP(
        CONSUMER_GROUP => 'OLTP_GROUP',
        COMMENT => '',
        CPU_MTH => 'ROUND-ROBIN');
    DBMS_RESOURCE_MANAGER.SUBMIT_PENDING_AREA();
END;
/

BEGIN
    DBMS_RESOURCE_MANAGER_PRIVS.GRANT_SWITCH_CONSUMER_GROUP(
        GRANTEE_NAME => 'HR', --db 유저를 포함시킴
        CONSUMER_GROUP => 'OLTP_GROUP', 
        GRANT_OPTION => FALSE);
END;
/
```
## 계획 생성
```SQL
BEGIN
    DBMS_RESOURCE_MANAGER.CLEAR_PENDING_AREA();
    DBMS_RESOURCE_MANAGER.CREATE_PENDING_AREA();
    DBMS_RESOURCE_MANAGER.CREATE_PLAN( -- 어떻게 소비하게 할 것인지 플랜을 만듦
        PLAN => 'DAYTIME',
        COMMENT => '',
        MGMT_MTH => 'EMPHASIS');
    DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE(
        PLAN => 'DAYTIME',
        GROUP_OR_SUBPLAN => 'OTHER_GROUPS',
        COMMENT => '');

    DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE(
        PLAN => 'DAYTIME',
        GROUP_OR_SUBPLAN => 'SYS_GROUP',
        MGMT_P1 => 100); --sys유저에게 자원 100% 먼저 줌

    DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE(
        PLAN => 'DAYTIME',
        GROUP_OR_SUBPLAN => 'OLTP_GROUP',
        MGMT_P1 => 0,
        MGMT_P2 => 80, -- sys에게 주고 남은 것의 80%를 OLTP에게
        ACTIVE_SESS_POOL_P1 => 10,
        QUEUEING_P1 => 3,
        PARALLEL_DEGREE_LIMIT_P1 => 10);

    DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE(
        PLAN => 'DAYTIME',
        GROUP_OR_SUBPLAN => 'DSS_GROUP',
        MGMT_P1 => 0,
        MGMT_P2 => 20 ); -- sys에게 주고 남은 것의 20%를 DSS에게

    DBMS_RESOURCE_MANAGER.SUBMIT_PENDING_AREA();
END;
/
```
## 실행
```SQL
SHOW PARAMETER resource_manager_plan 

-- ALTER SYSTEM SET RESOURCE_MANAGER_PLAN = 'DAYTIME' ; 
-- ALTER SYSTEM SET RESOURCE_MANAGER_PLAN = '' ; 
```
## 삭제 
```SQL
BEGIN
    DBMS_RESOURCE_MANAGER.CLEAR_PENDING_AREA();
    DBMS_RESOURCE_MANAGER.CREATE_PENDING_AREA();
    DBMS_RESOURCE_MANAGER.DELETE_PLAN_CASCADE(PLAN => 'DAYTIME');
    DBMS_RESOURCE_MANAGER.SUBMIT_PENDING_AREA();
END;
/
```
