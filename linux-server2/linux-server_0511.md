# ì›ê²© ì œì–´ ëª…ë ¹ì–´ (remote access) - ssh
* Secure SHell : ë³´í˜¸ëœ shell
* ì•”í˜¸í™” ëœ í†µì‹ ì„ ì œê³µ
  * ê°œì¸ key êµí™˜ì„ í†µí•´ ì•”í˜¸í™”ì— ì‚¬ìš©í•  keyë¥¼ ìƒì„±í•˜ê³ , ì•”í˜¸í™” ëœ í†µì‹ ì„ ì§„í–‰í•œë‹¤. (í‚¤ë¥¼ êµí™˜í•´ì„œ ì•”í˜¸í™”ì— ì“¸ ìƒˆë¡œìš´ í‚¤ë¥¼ ë§Œë“ ë‹¤ëŠ” ëœ»)
  * **ë³´ì™„ì„±ì´ ë†’ë‹¤.**
* version 1, 2ê°€ ìˆìœ¼ë©° í˜„ì¬ëŠ” version2ë¥¼ ì‚¬ìš©í•œë‹¤.
* LinuxëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ssh ì ‘ì†ì„ ì§€ì›í•œë‹¤. 
## ê´€ë ¨ì •ë³´
* íŒ¨í‚¤ì§€ : openssh-*  
  
  > * íŒ¨í‚¤ì§€ í™•ì¸ `rpm -qa | grep openssh`  
  >   ![image](https://user-images.githubusercontent.com/79209568/117772276-f9631180-b271-11eb-9784-dedb10f4f934.png)

* ë°ëª¬ : sshd  
  
  > * ë°ëª¬ í™•ì¸ `systemctl status sshd`  
  >   ![image](https://user-images.githubusercontent.com/79209568/117772622-53fc6d80-b272-11eb-8329-e5c630f80254.png)

* ë°©í™”ë²½ : port=22/tcp, service=ssh
* ì„¤ì •íŒŒì¼ : /etc/ssh/sshd_config

## ssh ì„¤ì • íŒŒì¼
* ì„¤ì • íŒŒì¼ ì—´ê¸° : `vi /etc/ssh/sshd_config`    
  ![image](https://user-images.githubusercontent.com/79209568/117775090-1ea54f00-b275-11eb-9be1-2c939e3d3631.png)
  * ì„¤ì • ê°’ë“¤ì˜ ê¸°ë³¸ ê°’ í™•ì¸ : `man sshd_config`
### ì„¤ì • ê°’
* `Port 22` : sshëŠ” ê¸°ë³¸ìœ¼ë¡œ 22ë²ˆ í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë˜ì–´ ìˆë‹¤.
  * ë‹¤ë¥¸ í¬íŠ¸ë¥¼ ì“°ê³  ì‹¶ìœ¼ë©´ ì£¼ì„ ì‚­ì œ í›„ ë‹¤ë¥¸ í¬íŠ¸ë¥¼ ì“´ë‹¤. *(= í¬íŠ¸ í¬ì›Œë”©)*
* `ListenAddress 0.0.0.0` : ì–´ë–¤ ì£¼ì†Œë¡œ ì ‘ì†ì„ í—ˆë½í•  ê²ƒì¸ì§€ ì„¤ì •. 0.0.0.0 ë‚´ê°€ ì–´ë–¤ ipë¥¼ ì“°ë˜ê°„ì— ë‚˜ì—ê²Œ ì ‘ì†í•  ìˆ˜ ìˆë‹¤.
 ```
 ë‚´ê°€ ì“°ëŠ” IPë“¤
 ens32 : 192.168.10.128
 ens33 : 192.168.10.129
 ens34 : 192.168.10.130

 ListenAddress 192.168.10.130 -> ë‹¤ë¥¸ IPë¡œëŠ” ì ‘ì†í•˜ì§€ ëª»í•˜ê³  130 IPë§Œ í—ˆìš©í•œë‹¤.
 ```
* í˜¸ìŠ¤íŠ¸ í‚¤
  ```
  HostKey /etc/ssh/ssh_host_rsa_key
  #HostKey /etc/ssh/ssh_host_dsa_key
  ```
  * ecdsa, ed25519 : ì¶”ê°€ í™•ì¥ key

* logging
  ```
  #SyslogFacility AUTH
  SyslogFacility AUTHPRIV
  ```
  * version1ì—ì„  auth ì‚¬ìš©, version 2ì—ì„  authpriv ì‚¬ìš©ì´ ê¸°ë³¸ ê°’

* authentication
  * `LoginGraceTime` : ë¡œê·¸ì¸ ëŒ€ê¸° ì‹œê°„ (ì¼ì • ì‹œê°„ ì´í›„ ì—°ê²° ëŠìŒ)
  * `PermitRootLogin` : ë£¨íŠ¸ë¡œì˜ ì§ì ‘ì ì¸ ë¡œê·¸ì¸ì„ í—ˆìš©í•  ê²ƒ ì¸ì§€
  * `StrictModes` : ë¹„ë°€ë²ˆí˜¸ ì—†ëŠ” ì ‘ì†ì„ í—ˆìš©í•  ê²ƒ ì¸ì§€(sshëŠ” ë¶ˆê°€ëŠ¥)
  * `MaxAuthTries` : ì•”í˜¸ë¥¼ í‹€ë¦´ ìˆ˜ ìˆëŠ” ìµœëŒ€ íšŸìˆ˜(ê·¸ ì´í›„ëŠ” ì—°ê²° ì‹œë„ë¥¼ ì•ˆí•¨)
  * `MaxSessions` : ìµœëŒ€ ì—°ê²° íšŒì„  ê°œìˆ˜
* `PubkeyAuthentication` : ê³µê°œ í‚¤ë¡œ ì¸ì¦í•˜ëŠ” ê²ƒì„ í—ˆìš©í•  ê²ƒ ì¸ì§€
* ì•”í˜¸ì—†ì´ ë¡œê·¸ì¸í•  ë•Œ í•„ìš”í•œ ì„¤ì •
  ```
  PasswordAuthentication yes
  #PermitEmptyPasswords no
  ```
* `Banner` : ë¡œê·¸ì¸í•  ë•Œ ë‚˜ì˜¤ëŠ” ë©”ì‹œì§€ ì„¤ì •
* `Subsystem       sftp    /usr/libexec/openssh/sftp-server` : sftpì— ëŒ€í•œ ì„¤ì • ë‚´ìš©

### ì„¤ì •í•˜ê¸°
* `PermitRootLogin no`ë¡œ ë³€ê²½í•´ë³´ê¸°  
  ![image](https://user-images.githubusercontent.com/79209568/117780027-316e5280-b27a-11eb-82a9-84b7ec869ab6.png)
  
  * í•˜ì§€ë§Œ ë‹¤ì‹œ rootë¡œ ì ‘ì†í•´ë„ ì ‘ì†ì´ ëœë‹¤. ë°”ë€ ì •ë³´ë¥¼ ì ìš©í•´ì•¼í•œë‹¤.
* ë°ëª¬ ì¬ ì‹¤í–‰
  ```
  systemctl restart sshd
  ```
  * ë£¨íŠ¸ ì ‘ì† ë¶ˆê°€ëŠ¥ ì ìš©ë¨  
  ![image](https://user-images.githubusercontent.com/79209568/117780709-d8eb8500-b27a-11eb-8d73-eaebb08020ba.png)
* ì´ë ‡ê²Œ ë£¨íŠ¸ ì ‘ì†ì„ ë¶ˆê°€ëŠ¥í•˜ê²Œ í•œ í›„ ë£¨íŠ¸ ì ‘ì†ì„ í•˜ë ¤ë©´ ì €ë²ˆì²˜ëŸ¼ ì¼ë°˜ ì‚¬ìš©ì ì ‘ì† í›„ `su -`ë¡œ ì ‘ì†í•´ì•¼í•œë‹¤.  
  ![image](https://user-images.githubusercontent.com/79209568/117780972-19e39980-b27b-11eb-9fc5-cc3ee120bcae.png)

ğŸ‘‰ [ì ‘ì† ëª…ë ¹ ì •ë¦¬](#ì ‘ì†-ëª…ë ¹-ì •ë¦¬)
## ssh ì ‘ì†í•˜ê¸°
* `ssh <ì ‘ì†í•  IP>` : ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•œ ì‚¬ìš©ìëª…ìœ¼ë¡œ ì ‘ì†
  * ë£¨íŠ¸ ì ‘ì†ì„ ë§‰ì•„ë†¨ê¸° ë•Œë¬¸ì— ë¡œê·¸ì¸ ê±°ì ˆì´ ëœë‹¤. (ctrl cë¡œ ì›ë˜ í”„ë¡¬í”„í† ë¡œ)  
    ![image](https://user-images.githubusercontent.com/79209568/117781531-b6a63700-b27b-11eb-9fb9-260e70d991c5.png)
* `ssh -l <ê³„ì •ëª…> <ì ‘ì†í•  IP>` : ê³„ì •ëª…ì„ ì…ë ¥í•˜ì—¬ ì ‘ì†
  * `ssh <ê³„ì •ëª…>@<ì ‘ì†í•  IP>` ì´ëŸ° í˜•ì‹ë„ ê°€ëŠ¥  
  ![image](https://user-images.githubusercontent.com/79209568/117782183-595eb580-b27c-11eb-808f-ce6fa11e061d.png)

## sftp ì ‘ì†í•˜ê¸°
* etcë¡œ ì´ë™
* `sftp <ì ‘ì†í•  IP>` : ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•œ ì‚¬ìš©ìëª…ìœ¼ë¡œ ì ‘ì†
* `sftp <ê³„ì •ëª…>@<ì ‘ì†í•  IP>` : ê³„ì •ëª…ì„ ì…ë ¥í•˜ì—¬ ì ‘ì†
* `put` ëª…ë ¹ì–´ë¡œ ì—…ë¡œë“œ ê°€ëŠ¥   
  ![image](https://user-images.githubusercontent.com/79209568/117783047-2668f180-b27d-11eb-8fd3-4d816f37fda0.png)

> ### ì ‘ì† ëª…ë ¹ ì •ë¦¬
> 1. ssh
>   * `ssh <ì ‘ì†í•  IP`> : ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•œ ì‚¬ìš©ìëª…ìœ¼ë¡œ ì ‘ì†
>   * `ssh -l <ê³„ì •ëª…> <ì ‘ì†í•  IP>` : ê³„ì •ëª…ì„ ì…ë ¥í•˜ì—¬ ì ‘ì†
>   * `ssh <ê³„ì •ëª…>@<ì ‘ì†í•  IP>` : ê³„ì •ëª…ì„ ì…ë ¥í•˜ì—¬ ì ‘ì†
> 2. sftp(secure shell + ftp)
>   * `sftp <ì ‘ì†í•  IP>` : ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•œ ì‚¬ìš©ìëª…ìœ¼ë¡œ ì ‘ì†
>   * `sftp <ê³„ì •ëª…>@<ì ‘ì†í•  IP>` : ê³„ì •ëª…ì„ ì…ë ¥í•˜ì—¬ ì ‘ì†
> 3. scp(secure shell + rcp) 
>   * rcp : ì›ë˜ cp ëª…ë ¹ì–´ê°€ í•˜ë‚˜ì˜ ì¥ì¹˜ ì•ˆì—ì„œ ë³µì‚¬ë¥¼ ì§€ì›í–ˆë‹¤ë©´ scpëŠ” ì¥ì¹˜ ê°„ì˜ íŒŒì¼ ë³µì‚¬ë¥¼ ì§€ì›í•´ì£¼ëŠ” ëª…ë ¹ì–´  
>     * `rcp ì›ë³¸ <ì¥ì¹˜ IP>:<ë³µì‚¬í•  ìœ„ì¹˜>` : ë‚´ íŒŒì¼ì„ ë‹¤ë¥¸ ì¥ì¹˜ì— ë³µì‚¬
>     * `rcp <ì¥ì¹˜ IP>:<ì›ë³¸> <ë³µì‚¬í•  ìœ„ì¹˜>` : ë‹¤ë¥¸ ì¥ì¹˜ì— ìˆëŠ” íŒŒì¼ì„ ë‚˜í•œí…Œ ë³µì‚¬

# ì‹¤ìŠµ
```
ê°€ìƒë¨¸ì‹  ë‘ ê°œ ì „ë¶€ PermitRootLogin ê°’ì€ noë¡œ ì„¤ì •

server : 192.168.217.128, /tmp ì†ì— Aë¼ëŠ” íŒŒì¼ ìƒì„±
client : 192.168.217.129, /test ë””ë ‰í„°ë¦¬ ìƒì„±

scp ì˜ˆë¬¸ ë‘ ê°œ ë‹¤ ì‹¤í–‰í•´ë³´ê¸°
(ë‹¨, í•˜ë‚˜ ì™„ë£Œ í›„ ë°˜ë“œì‹œ /test/A ì‚­ì œ í•  ê²ƒ)

scp 192.168.217.128:/tmp/A /test
scp /tmp/A 192.168.217.129:/test

* ì°¸ê³  *
ssh ê³„ì •ëª…@192.168.217.128
```
